## *many to many* relationship with *bridge table* "recipe_ingredient"  
> [!NOTE]  
> Read about [Crow’s Foot Entity Relationship Diagram (ERD)](https://medium.com/@callista.m.azizah/crows-foot-erd-for-beginners-a-tutorial-1effc8a326c6)  
> like this one below   
#### A cookbook data model  
<img width="400"  alt="image" src="https://github.com/user-attachments/assets/e69ff21c-f775-497c-9556-771c489d1bed" />  

```sql
create table dish_recipe
(id integer primary key generated by default as identity, -- serial ?
name text not null,
instructions text,
notes text);

create table category
(id integer primary key generated by default as identity,
name text not null);

create table color
(id integer primary key generated by default as identity,
name text not null,
color_attribute integer);


create table taste
(id integer primary key generated by default as identity,
name text not null);

create table intensity
(id integer primary key generated by default as identity,
name text not null);

create table unit
(id integer primary key generated by default as identity,
name text not null);


create table ingredient
(id integer primary key generated by default as identity,
name text not null,
category_id integer references category(id), 
color_id integer references color(id),
taste_id integer references taste(id),
intensity_id integer references intensity(id),
unit_id integer references unit(id)); 

create table recipe_ingredient
(dish_id integer references dish_recipe(id),
ingredient_id integer references ingredient(id),
quantity numeric,
notes text);

insert into category (name) values ('Зеленчуци'),('Плодове'),('Подправки'),('Варива'),('Месо'),('Млечни продукти');

insert into color (name) values ('Червен'), ('Зелен'), ('Син'), ('Жълт'), ('Оранжев'), ('Бял'), ('Лилав');

insert into taste (name) values ('Сладък'), ('Солен'), ('Кисел'), ('Горчив'), ('Лют');

insert into intensity (name) values ('Силен'), ('Слаб'), ('Среден');

insert into unit (name) values ('Килограм'), ('Литър'), ('Щипка'), ('Грам');


insert into dish_recipe (name, instructions) values ('Таратор', 'По обичайния начин'), 
('Шопска салата', 'Може и с магданоз');

insert into ingredient (name, category_id, color_id, taste_id, intensity_id, unit_id) values
('Домат', 1, 1, 3, 3, 1),
('Краставица', 1, 2, 3, 3, 1),
('Сирене', 6, 6, 2, 3, 1);

select i.name, c.name, col.name, tst.name, its.name, u.name
from ingredient i
join category c on i.category_id = c.id
join color col on i.color_id = col.id 
join taste tst on i.taste_id = tst.id
join intensity its on i.intensity_id = its.id
join unit u on i.unit_id = u.id;

insert into recipe_ingredient(dish_id, ingredient_id, quantity) 
values (2, 1, 0.5), (2, 2, 0.5), (2, 3, 0.100)

select ri.quantity, ri.notes,  dr.name, dr.instructions, dr.notes,
i.name,  c.name,  co.name, co.color_attribute,
t.name,  inte.name, u.name 
from recipe_ingredient ri 
join dish_recipe dr on dr.id = ri.dish_id
join ingredient i on i.id = ri.ingredient_id
join category c on i.category_id = c.id 
join color co on i.color_id = co.id 
join taste t on i.taste_id = t.id
join intensity inte on i.intensity_id = inte.id
join unit u on i.unit_id = u.id;
```
> [!NOTE]  
> Maintaining [referential integrity](https://en.wikipedia.org/wiki/Referential_integrity)

```sql
delete from color where name = 'Зелен';
```  
SQL Error [23503]: ERROR: update or delete on table "color" violates foreign key constraint "ingredient_color_id_fkey" on table "ingredient"  
Detail: Key (id)=(2) is still referenced from table "ingredient".





